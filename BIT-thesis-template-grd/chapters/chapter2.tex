%%==================================================
%% chapter02.tex for BIT Master Thesis
%%==================================================
\chapter{相关工作}
本章对本文研究内容的相关工作进行简要介绍。首先是基于以太坊的树状区块链，具体涉及传统区块链的性能瓶颈和树状区块链的结构特性。第二是GeoHash地理信息，具体介绍GeoHash地理信息便于区域绑定和查询的特点，基于GeoHash的几何原理，以及矢量地图渲染框架leaflet。第三是出租车调度系统的发展现状，并指出其安全性上的不足和解决方法。第四是路径规划算法，介绍路径规划算法的发展种类，对比其性能和特点，在此基础上简要介绍基于GeoHash的路径规划算法设计。

\section{基于以太坊的树状区块链}
% 介绍区块链的性能瓶颈，引出树状区块链的研究目的、简要介绍原理。
% 树状区块链融合了地理信息，分为创世块、分支块（只维护直接下层区域的索引信息）和普通块（记录在对应地理区域内发生的交易）。
区块链是一个共享的不可更改的总账，它用于记录交易、跟踪资产以及建立信任\upcite{王震2019面向大数据应用的区块链解决方案综述}。几乎所有有价值的东西都可以在区块链网络上进行跟踪和交易，从而降低了风险并削减了所有相关成本。区块链是传递交易信息的理想选择，因为它可以提供在不可更改的总账中的即时、共享且完全透明的信息，这类信息同时具备一定的安全性，只能由获得许可的网络成员访问。另外，区块链网络也可以跟踪订单、付款、账户、生产等等，因此可以通过此类技术手段减少不必要的交易纠纷。\par
智能合约是存储在区块链上的程序，可以在满足预定条件的情况下运行，它们通常是自动执行的脚本，以便所有参与者无需任何中介机构的参与就可以立即结果，极大保证安全性。智能合约代码语句十分简单，当预定条件已经得到满足并完成验证时，区块链网络将执行对应动作，比如释放资金，发出凭证等，然后交易完成时更新区块链。由智能合约完成的交易也是无法更改的，只有获得许可的参与者才能看到结果。本文是基于以太坊改进的树状区块链平台来设计和部署智能合约，在此基础上进行出租车调度系统的研究。

\subsection{传统区块链的特点和不足}
% 传统区块链的发展，发展到以太坊，以太坊性能上的不足，以及解决以太坊性能的方法。
% 1. 安全性和性能上的不足
% 2. 对地理信息缺乏自有支持
% 3. 要满足车载自组网的灵活和移动特性
% 利用智能合约设计系统
传统区块链技术整个网络同时只有一条单链，基于 PoW 共识机制出块无法并发执行，无法满足车载自组网对高并发操作和网络稳定性的需求，传统区块链也不具备移动性，无法与地理位置信息进行绑定，不能有效利用车载网中地理信息的区域化特性。另外，传统区块链的单链结构，要求所有节点必须在同一区块链中，这将会导致节点数目和数据量过大，不满足车载自组网中车辆节点的移动特性，且一旦出现网络分区，就会对整个区块链产生很大影响。目前采用分片技术更改原始单链的链式结构是解决上述问题的主流方法\upcite{2018Blockclique}。当前也有多链结构的相关工作。根据多链结构是否改变底层区块链结构可分为应用多链和结构多链。应用多链，即在应用层面建立不同功能的多个区块链，没有修改底层区块链结构。结构多链，即根据需求对区块链底层结构进行调整的多链结构。
\subsubsection{应用多链}
Shrestha 等\upcite{2019Regional}研究了区域区块链在车载自组网中的应用。由物理边界区域内的节点共享的区块链，区域内部的传播延迟比较小，可以极大减少消息延迟，但此研究并没有设计跨区域和跨链交易的相关内容。\par
Hirtan 等\upcite{2019Blockchain}提出了一种包含专用链和公用链的医疗保健系统。专用链保存患者的真实身份信息；公用链存储患者的健康信息以及临时 ID 数据，实现隐私数据保护和可用数据公开访问。此研究通过特定节点掌握患者临时 ID 和真实身份的关联，来实现两个区块链数据的传递。

\subsubsection{结构多链}
Youngjune 等人\upcite{2019Monoxide}建立多个独立并行的单链共识组。各个共识组地位平等，大部分交易只在组内完成，跨组交易则采用异步方式将中继事务发送到目标区域，而不是整个网络，减轻了网络负载。值得一提的是，为了确保每个区域中的有效采矿能力与整个网络处于同一水平，采用了诸葛弩改进 PoW 的挖矿方式，这也同时保证了分组抵御攻击的能力。但其共识组分区方法没有考虑实际地理位置信息，同时车载自组网中跨区域交易的规模较大，此研究的跨组交易的网络开销较大，不适用于车载自组网。\par
Zamani 等人\upcite{2018RapidChain}提出了基于分片的公共区块链协议，将节点划分为多个较小的称为委员会的节点组，节点组在不相交的交易块上并行操作，并维护不相交的独立账本，也就是分片，分片由每个成员以区块链的形式存储。为了解决节点频繁移入移出对网络造成的影响，将委员会分为活跃和不活跃两个分类，节点创建后，第一次进入委员会需要加入活跃类，再次进入或转移时需要加入不活跃类。但委员会内节点数量固定，缺少灵活性；委员会构建和重构时不涉及地理因素，增加了更新时间，不适用于车载自组网。\par
Byung 等人\upcite{Byung2018Hybrid}将物联网与基于区块链的智能合约相结合，用于结构健康监视 (SHM)。这个区块链物联网网络分为核心和边缘网络。边缘节点充当查询实时响应的集中式服务器，并提供低延迟和带宽使用率，核心网络由具有高存储容量的miner 节点组成，负责生成新块、验证工作证明，并包含自主决策的智能合约，这种划分提高了系统的效率和可伸缩性，但核心网络十分庞大是主要问题。核心网络的庞大影响移动节点的交易效率。\par
Pajooh 等人\upcite{2021Multi}提出了一种多层区块链安全模型来保
护物联网网络，同时利用群集的概念来简化多层架构，通过使用模拟退火和遗传算法相结合的混合进化算法来定义物联网 K- 未知簇，选择的群集头负责本地身份验证和授权，增强了网络认证机制的安全性，显示出更适合的平衡网络延迟和吞吐量。但上述两类区块链研究没有考虑到地理因素，跟适用于车载自组网的区块链结构还有一定的距离。\par
Ochôa 等人\upcite{2019A}提出了侧链结构，由 BlockPRI、BlockSEC、BlockTST 三个不同的区块链，使用了三个区块链来确保系统的隐私性，安全性和信任性。BlockPRI 存储每个用户的隐私首选项。BlockSEC 存储用户的数据。最后，BlockTST 管理并验证有关消费者-生产者与消费者-公司之间的能源贸易的信息。为了保证区块链之间的通信，需要通过智能合约维护多链数据一致性。本文吸收了用智能合约自主决策的思想，基于改进的区块链结构和智能合约实现出租车调度系统。
\subsection{树状区块链的特性}
车载自组网具备低成本、低时延以及地理位置天然联系的特性，在道路安全等应用提供了重要支持\upcite{2020Application}。区块链作为一种新型的互联网模式，具备去中心化、不可篡改、可追溯等特点，与车联网的联系愈发紧密\upcite{2021Blockchain}。但实际应用上主要包括两个问题，首先，区块链技术通常要求可靠的网络接入，而车载自组网高动态性的接入方式引发的网络不稳定对区块链的应用造成了极大的挑战。其次，车载自组网中的信息通常与地理信息天然绑定，而传统区块链并不支持此特性。因此，研究将地理位置与区块链融合的树状区块链[周畅论文]就是为上述灵活性和地理区域问题提供一种可能的解决方案。\par
由于全局同步与共识速度的限制，传统区块链不能很好的适应车载自组网的高动态性，并且不能保证车辆与路侧节点的稳定连接，这将会极大影响到区块链共识机制的可用性。车载自组网与地理信息天然相联，并且车辆通常只需要关注特定区域的信息，而传统区块链记录的交易信息不包含位置，无法根据地理区域查询交易，且传统区块链全局同步的设计会造成网络资源的大量浪费，并且传统区块链无法根据地理信息高效地查询账户和交易相关的数据。树状区块链对区块链的结构进行修改与优化，使其更能适应车载自组网特性。树状区块链是一种基于位置的区块链[周畅论文]，首先，根据 GeoHash 地理编码与地理区域层次关系建立树状结构的区块，同时研究树状结构地理信息相关数据查询速度的优化机制，从而提升区块链在车载自组网中的吞吐量以及与地理信息相关数据的检索速度。\par
GeoHash 是一个能表示任意精度的高效地理编码系统，它使用二分法将指定区域分为网格，每个网格由唯一的编码表示，网络的大小对应的层次不同，编码越长对应的网格越小，层次越低。树状区块链使用 GeoHash 地理编码作为基本数据编码方式。建立 GeoHash 与区块以及交易的索引，从而依据 GeoHash 编码直接获取区域交易内容，同时，GeoHash 编码可以通过前缀对区域信息进行绑定，因此通过 GeoHash 编码可以很自然地建立区域层次与子链的联系。因此本文选用树状区块链平台来实现分布式的出租车调度系统。
\section{矢量地图研究}
本节回顾和讨论了 Web 客户端访问地图数据的应用程序中涉及的矢量地图编码和空间索引方法。然后简单介绍了本文采用的 GeohashTile 系统使用的 Geohash 编码方法和 Leaflet 以及相关工作的比较。\par
矢量数据的编码是影响其传输性能和可复用性的关键因素。XML 和 JSON 是 Web 应用程序中常用的两种矢量数据编码方法\upcite{2011Improving}。XML（可扩展标记语言）\upcite{1997Extensible} 用作 Internet 信息交换的标准。由于 XML 使用的语法不够轻量，不利于 Internet 上的数据传输\upcite{2017Data}。
\subsection{矢量地图数据编码}
GeoJSON 是一种用于编码各种地理数据结构的开放标准格式，可用于表示简单的地理特征。GeoJSON 可以比 XML 更方便、更快速地被计算机解析，数据结构更轻量易读\upcite{2015Performance}。GeoJSON 作为一种轻量级的数据编码方法，适用于移动设备之间的数据传输\upcite{2017Tiled}。考虑到编码方式的传输性能、可读性和易分析性，我们选择GeoJSON作为移动设备矢量数据的编码方式。
\subsection{矢量地图空间索引技术}
空间索引技术是提高海量空间数据查询效率的关键技术。空间索引对瓦片金字塔的地理数据进行管理和维护具有重要的作用，其性能直接影响地理信息网络服务的整体性能。其中，网格索引和四叉树索引是瓦片金字塔模型中广泛使用的空间索引方法\upcite{2014A, 2012Spatial, 2009A}。\par
网格索引是按照一定的分辨率等级，将地理信息进行划分并按照矩形网格排列\upcite{Sagan2014Space}。网格索引法要求在查询金字塔中的任何一个瓦片时，只需要查询三个值，即分别代表行、列坐标和缩放级别的X、Y和Z。网格索引是最早的索引方法之一，形式简单。但是，三字段查询也使得它在海量数据的情况下效率低下。\par
四叉树索引以其每个内部节点都有四个子节点命名，是多分辨率在线地图的常用索引方法。该索引方法具有编码简单、易于实现的优点，已被微软必应地图在内的大多数主要网络地图服务提供商采用。\par
谷歌地图的索引方式与网格索引相同。(x, y, z) 三个字段用于表示图块索引值。因此存在海量数据查询效率低的问题。Bing Maps使用（z，quadkeys）两个字段来表示图块索引值，其中 quadkeys 称为四叉树键，通过按位交叉组合将二维块XY坐标组合成一维字符串来优化索引和存储。\par
Geohash 的索引方法是将第 M 层中的一个块划分为第 M+1 层中的 n 个块，所以它也是一种类似四叉树索引方法。与常见的索引结构相比，Geohash 在索引时不需要经过递归计算，因此空间索引只有一层，使得其动态更新更简单\upcite{2014A}。
% 目前，Geohash 已被广泛用于处理具有一维索引的空间数据 [6,22,26,27]。

\subsection{Geohash 编码}
Geohash编码将纬度和经度分别转换为一组二进制字符串，然后将这两组字符串逐位交叉，生成一组新的二进制字符串。然后将新字符串每五位转成一个十进制数，按顺序转换成base32编码，这样就可以使用用一维数组表示二维数组\upcite{2014A}。\par
% Geohash的划分过程如图1所示。 
与谷歌地图的编码方式相比，Geohash 将二维空间查询转换为一维字符串匹配。凭借这一优势，Geohash 可以实现时间复杂度为 O(1) \upcite{2014A} 的快速查询。与Bing Maps的编码方式相比，Geohash 采用 Base32 编码方式，即同一个前缀下有 32 个不同的子序列，而 Bing Maps 编码方式是 Base4，即同一个前缀下只有 4 个不同的子序列，所以 Geohash查询更方便。文献\upcite{2014A}还表明，基于 Geohash 的空间索引算法对海量地理数据具有高性能的查询能力。根据编码长度的不同，Geohash可以同时表示图块的索引范围和坐标，实现统一编码。

\subsection{Leaflet矢量地图渲染框架}
Leaflet 是地图的开源 JavaScript 库之一，是 B/S 端 WebGIS 开发项目中广泛使用的开源软件。开发者可以基于库中提供的接口进行开发和扩展，实现地理信息服务的调用和地图数据的基本操作\upcite{2019The}。Leaflet 强大的开源库插件涉及地图应用的方方面面，包括地图服务、数据提供、数据格式、地理编码、地图控制与交互等，也支持自定义控件的实现。这些控件丰富了 Leaflet \upcite{2016Adgt} 的功能。本文的出租车调度系统基于轻量级WebGIS库Leaflet来呈现客户端数据，并拓展了其支持GeoHash数据格式的显示功能。

\section{出租车调度系统}
% 介绍出租车调度系统的研究现状，
% 1. 指出中心化系统的不足，容易引发信息垄断、信息泄露和恶性竞争。（2篇）
% 2. 非分布式系统，性能问题是瓶颈，未考虑信息加密（1篇）
% 3. 现有的区块链系统。（1篇）
% 4. 采用区块链或者以太坊的系统，但是不够好，比如性能优化不够好，或者功能不够完善（1篇）
随着互联网通信技术的发展，打车软件和其背后的企业以指数级的速度成长，软件平台的即开即用，让乘客主动广播打车需求，方便了居民出行，同时其灵活性和较高的薪酬水平也在吸引全职和兼职司机的不断加入。一项研究\upcite{2016An}表明，对灵活工作时间的向往驱使着司机们和打车平台的企业进行合作。但在鼓励此类企业发展以解决就业和城市管理效率的同时，也应当对其行使的权力进行监管，避免出现敏感信息垄断、滥用、泄露，从而造成难以预计的后果。\par

\upcite{2015The}提到了一种在用车高峰时进行激增定价的策略，目的是提高司机在用车高峰时的工作积极性，满足乘客在高峰期间的多样化乘车需求，所有利益相关者都可以从具有自我调度能力的平台上通过激增定价策略受益。但实际是让打车平台获得了更多攫取利益的空间，使得平台的使命从方便公共交通转向了使自己利益最大化。\par

传统中心化调度系统在存储容量和处理性能方面存在不足，当访问服务器的需求规模扩大后，系统就无法及时处理接收到的需求数据，进而导致响应速度降低和服务质量的下降。随着数据规模的逐渐扩大，单机环境下的处理模式已经不适用于海量数据的存储与计算，分布式存储与计算应运而生\upcite{孙仕亮2017大数据分析的硬件与系统支持综述}。但是事实上，由打车软件提供商设计的分布式系统，其收集和存储到服务器中的用户数据很可能会被泄露给第三方，特别在导航系统中，车辆司机和用户都会提交GPS位置和个人账户信息来获得交通服务和进行导航服务，服务商会出于自己的目的处理用户隐私。\par

文献\upcite{2016Self}的研究将车载网和以太坊结合，实现了透明、自管理的去中心化系统，文章中使用以太坊账户作为车载网中车辆的个人账户，利用智能合约的定制功能，实现个人账户与交通违法行为或税费事物的自动交互，从而实现自管理功能，证明了以太坊平台可以应用于交通领域，但没有实现支持真实交通数据的车辆调度系统。\par

文献\upcite{2018HACIT2}的研究基于Hyperledger Fabric平台，提出了一种使用区块链技术的创新方法，避免了使用第三方软件企业的服务，从而在固定地理区域内实现动态导航路由，同时确也能保用户的匿名性。其不足之处在于，一是作为区块链系统要经常跟第三方库打交道，比如动态路径的生成和改变就依赖在线OSM库，可能导致信息泄露；二是没有充分考虑性能问题，可以利用特殊的地理数据格式来简化算法和存储。采用基于GeoHash的地理信息做存储、导航和调度是不错的改进。

\section{路径规划算法}
% 介绍路径规划算法的发展历史和研究现状，分类简要介绍几种路径规划算法的优缺点，解释为什么有的路径规划算法不适合应用于静态网格道路，指出区块链应用缺乏路径规划算法的支持，以及在区块链中将路径规划算法与GeoHash结合的优点。
% 1. 区分动态和静态路径规划算法
% 2. 解释动态路径规划算法不适用
% 3. 静态算法性能对比
路径规划即通过对道路结构的分析找到最短的路径，最短的概念包括很多维度，比如单纯的从起点到终点的路径长度最短，或者路径的通行时间最短，或者是路径上的路口和交通灯最少等。出租车司机可以根据自己的需求来选择不同类型的最短路径。近几年随着自动驾驶汽车和智能交通系统等概念的炒作，最短路径的求解这一问题的研究热度也随之提升，现有的最短路径规划方法主要分为静态路径规划和动态路径规划两种。\par
静态路径规划算法，即在服务器存储的静态矢量网格地图中寻找从起点到终点的最短路径，可以基于不同的道路权值，计算出该类权值下的最优路径。Dijkstra算法是此类算法的鼻祖\upcite{1959A}，Dijkstra算法属于单源最短路径算法，算法规则是从起点开始扩张，向外搜索到达所有节点的最短路径，其时间复杂度是O($ n^{2} $)，文献\upcite{2004Taxi}的研究用Dijkstra算法规划了最短路径，设计了基于即时乘车需求和实时路况的路径规划算法。此外，经典的静态路径规划算法还有Floyd算法\upcite{1989A}、A*算法\upcite{1972A}，Floyd算法使用的是两个二维数组，它们分别代表图中所有的顶点到所有顶点的最短路径值的总合，以及对应顶点的最小路径的上一跳顶点，此算法考虑到了两点间距离是负值的情况，该算法复杂度是 O($ n^{3} $)；A*算法在Dijkstra算法的基础上使用了启发函数，它结合了Dijkstra和启发式算法的优点，以从起点到中间计算点的距离加上该中间点到终点的估计距离之和作为该中间点在优先队列中的优先级，该优先队列在算法执行过程中用来选择中间点的下一跳，A*算法与Dijkstra相比明显降低了时间复杂度。\par
动态路径导航规划方法最早由Cooke and Halsey\upcite{1966The}提出，动态路径规划根据特定类型的道路权值求解起点到重点之间的最短路径，同时实时维护道路信息，对预先规划好的最短路径进行合理的调整，如此维护导航结果直到车辆到达目的地，最终的行车路线即为最优的路径。文献\upcite{孙海鹏2007基于实时交通信息的动态路径规划技术}将实时交通信息动态地记录为该路段的通行时间，以此数据来支持路径规划。\par
文献\upcite{汤永喜2015出租车智能调度终端管理系统的设计与实现}的研究将遗传算法的思想应用到了动态路径规划中，提出了基于动态交通网络模型和遗传算法的最优路径选择算法。但是遗传算法的初始化种群染色体适应度（即连接首尾的路径开销）、“轮盘赌”选择法都增加了不必要的算法负担。且要一直运算到种群中连续N代个体的适应度值基本保持不变，才可选择最优路径，算法开销过大，不适合大规模路段。与Dijkstra算法相比，遗传算法在大型的网格地图中导航容易导致性能瓶颈\upcite{马超2012遗传算法和}。\par
即使是基于实时路况进行路径计算的动态导航，也存在实时交通信息获取的可靠性和准确性问题，以及数据的高效存储和服务器的实时响应等问题，这些问题导致动态路径规划的算法体系不够成熟完善，路径规划的反馈结果不够及时和准确。理论上，遵照这些最短路径算法的结果，就可以得到最优路径的走法。实际上，驾驶员更愿意根据即时有效的路径规划结果来自己判断更有效的路径。本文在基于以太坊的树状区块链应用中实现了静态矢量地图路网的存储，基于此采用A*算法的思路设计路径规划算法，不同于传统的A*算法，本文在使用 A*算法进行路径规划时支持了GeoHash的数据格式。A*的启发函数基于GeoHash格式进行运算，简化了相比基于经纬度数据的运算量，优化了服务端的存储性能和算法响应速度，更适合分布式和安全性兼顾的出租车调度系统的设计。


